<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCANNER LOG [FILTER MODE]</title>
    <style>
        /* Einheitlicher Schriftstil f√ºr das gesamte Dokument */
        body, label {
            font-family: Arial, sans-serif;
			font-size: 14px;
        }

        /* Container for the search and refresh controls */
        #controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            width: 100%;
            box-sizing: border-box;
        }

        /* Flexible area for the search input */
        #searchContainer {
            flex: 1;
            display: flex;
            align-items: center;
        }

        /* Styling for the search input */
        #searchInput {
            padding: 5px;
            width: 100%;
            max-width: 300px;
            box-sizing: border-box;
            margin-right: 10px;
        }

        /* Container for the distance filter checkboxes */
        #filterContainer {
            display: flex;
            gap: 10px;
        }

        /* Container for the buttons */
        #buttonContainer {
            display: flex;
            align-items: center;
        }

        /* Styling for the buttons */
        .button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
            margin-left: 10px; /* Space between buttons */
        }

        /* Styling for the refresh button */
        #refreshButton {
            background-color: #007bff;
        }

        /* Styling for the dark mode button */
        #darkModeButton {
            background-color: #6c757d;
        }

        /* Styling for the refresh button when auto-refresh is off */
        #refreshButton.off {
            background-color: #6c757d;
        }

        /* Dark mode styling */
        body.dark-mode {
            background-color: #121212;
            color: white;
        }

        body.dark-mode table {
            color: white;
        }

        body.dark-mode th {
            background-color: #1f1f1f;
        }

        body.dark-mode td {
            border-color: #333;
        }

        /* Make table headers clickable */
        th {
            cursor: pointer;
        }

        /* Table styling */
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto; /* Ensure columns are auto-sized */
        }

        /* Styling for table cells */
        th, td {
            padding: 3px;
            text-align: left;
            white-space: nowrap; /* Prevents text from wrapping */
        }

        /* Background color for table headers */
        th {
            background-color: #f2f2f2;
        }

        /* Dark mode styling for links */
        body.dark-mode a {
            color: #d6a8f5; /* Light purple color */
        }

        body.dark-mode a:hover {
            color: #b57edc; /* Slightly darker purple for hover effect */
        }

        /* Dark mode styling for the search input */
        body.dark-mode #searchInput {
            background-color: #6c757d; /* Match the color of the dark mode toggle button */
            color: white; /* Ensure text is readable */
        }

        /* Dark mode styling for the search input placeholder */
        body.dark-mode #searchInput::placeholder {
            color: white; /* Light gray placeholder text for better readability */
        }
    </style>
    <script>
        let autoRefresh = true; // Controls whether auto-refresh is enabled
        let refreshInterval = 10000; // Refresh interval in milliseconds (10 seconds)
        let refreshTimeout; // Timeout ID for the refresh function

        /* Get the value of a cookie by name */
        function getCookie(name) {
            const cookieName = name + "=";
            const cookies = decodeURIComponent(document.cookie).split(';');
            for (let i = 0; i < cookies.length; i++) {
                let cookie = cookies[i];
                while (cookie.charAt(0) === ' ') {
                    cookie = cookie.substring(1);
                }
                if (cookie.indexOf(cookieName) === 0) {
                    return cookie.substring(cookieName.length, cookie.length);
                }
            }
            return "";
        }

        /* Set a cookie with a specific name, value, and expiration (in days) */
        function setCookie(name, value, days) {
            const expires = "expires=" + new Date(Date.now() + days * 864e5).toUTCString();
            document.cookie = name + "=" + value + ";" + expires + ";path=/";
        }

        /* Toggle the auto-refresh functionality */
        function toggleRefresh() {
            autoRefresh = !autoRefresh;
            const button = document.getElementById('refreshButton');
            button.classList.toggle('off', !autoRefresh);
            if (autoRefresh) {
                startAutoRefresh();
            } else {
                clearTimeout(refreshTimeout);
            }
        }

        /* Starts the auto-refresh function */
        function startAutoRefresh() {
            refreshTimeout = setTimeout(() => {
                location.reload();
            }, refreshInterval);
        }

        /* Sorts the table based on column index (n) */
        function sortTable(n, isNumeric = false) {
            const table = document.querySelector("table");
            let rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
            switching = true;
            dir = "asc";

            /* Keep switching rows until sorting is complete */
            while (switching) {
                switching = false;
                rows = table.rows;

                /* Loop through the rows, skipping the header */
                for (i = 1; i < (rows.length - 1); i++) {
                    shouldSwitch = false;
                    x = rows[i].getElementsByTagName("TD")[n];
                    y = rows[i + 1].getElementsByTagName("TD")[n];

                    /* Compare based on numeric or string content */
                    let xContent = isNumeric ? parseFloat(x.innerHTML) || 0 : x.innerHTML.toLowerCase();
                    let yContent = isNumeric ? parseFloat(y.innerHTML) || 0 : y.innerHTML.toLowerCase();

                    /* Determine if a switch is needed based on direction */
                    if (dir == "asc") {
                        if (xContent > yContent) {
                            shouldSwitch = true;
                            break;
                        }
                    } else if (dir == "desc") {
                        if (xContent < yContent) {
                            shouldSwitch = true;
                            break;
                        }
                    }
                }
                if (shouldSwitch) {
                    /* Make the switch and mark switching as true */
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                    switchcount++;
                } else {
                    /* If no switching happened, change the direction */
                    if (switchcount == 0 && dir == "asc") {
                        dir = "desc";
                        switching = true;
                    }
                }
            }
        }

        /* Filters table rows based on input value and distance filters */
        function filterTable() {
            const input = document.getElementById("searchInput");
            const filter = input.value.toLowerCase();
            const table = document.querySelector("table");
            const tr = table.getElementsByTagName("tr");

            // Checkbox-Filter
            const filter200 = document.getElementById("filter200").checked;
            const filter450 = document.getElementById("filter450").checked;
            const filter750 = document.getElementById("filter750").checked;
            const filter1200 = document.getElementById("filter1200").checked;

            let distanceFilter = 0;

            if (filter200) {
                distanceFilter = 200;
            } else if (filter450) {
                distanceFilter = 450;
            } else if (filter750) {
                distanceFilter = 750;
            } else if (filter1200) {
                distanceFilter = 1200;
            }

            // Loop through all table rows
            for (let i = 1; i < tr.length; i++) {
                let td = tr[i].getElementsByTagName("td");
                let display = false;

                // Filter based on search input
                if (filter) {
                    for (let j = 0; j < td.length; j++) {
                        if (td[j].textContent.toLowerCase().indexOf(filter) > -1) {
                            display = true;
                            break;
                        }
                    }
                } else {
                    display = true;
                }

                // Filter based on distance
                if (display && distanceFilter > 0) {
                    let distValue = parseFloat(td[10].textContent) || 0; // Assume 'DIST' is in the 11th column (index 10)
                    if (distanceFilter === 200 && distValue <= 200) {
                        display = false;
                    } else if (distanceFilter === 450 && distValue <= 450) {
                        display = false;
                    } else if (distanceFilter === 750 && distValue <= 750) {
                        display = false;
                    } else if (distanceFilter === 1200 && distValue <= 1200) {
                        display = false;
                    }
                }

                // Show or hide the row based on the filter
                tr[i].style.display = display ? "" : "none";
            }

            generateDynamicLink(); // Update the link after filtering
        }

        /* Toggle Dark Mode */
        function toggleDarkMode() {
            const body = document.body;
            const isDarkMode = body.classList.toggle("dark-mode");
            setCookie("darkMode", isDarkMode, 365); // Save preference for 1 year
        }

        /* Apply Dark Mode based on cookie */
        function applyDarkMode() {
            const darkMode = getCookie("darkMode");
            if (darkMode === "true") {
                document.body.classList.add("dark-mode");
            }
        }

        /* Generates a dynamic link based on visible table rows */
        function generateDynamicLink() {
            const table = document.querySelector("table");
            const rows = table.getElementsByTagName("tr");
            const uniqueIds = new Set();

            // Loop through table rows to collect IDs
            for (let i = 1; i < rows.length; i++) {
                if (rows[i].style.display !== "none") { // Only consider visible rows
                    const cells = rows[i].getElementsByTagName("td");
                    const idCell = cells[cells.length - 3]; // The ID cell (3rd last cell)
                    if (idCell) {
                        const idValue = idCell.textContent.trim();
                        if (idValue) {
                            uniqueIds.add(idValue);
                        }
                    }
                }
            }

            // Check if IDs were found
            if (uniqueIds.size > 0) {
                const idsString = Array.from(uniqueIds).join(",");
                const baseUrl = "https://maps.fmdx.org/#qth=51.292626,12.446437&id=";
                const dynamicLink = baseUrl + idsString + "&findId=*";

                // Create or update link element
                let dynamicLinkElement = document.getElementById("dynamicLink");
                if (!dynamicLinkElement) {
                    dynamicLinkElement = document.createElement("a");
                    dynamicLinkElement.id = "dynamicLink";
                    dynamicLinkElement.target = "_blank";
                    document.body.appendChild(document.createElement("pre")).appendChild(dynamicLinkElement);
                }
                dynamicLinkElement.href = dynamicLink;
                dynamicLinkElement.textContent = "FMDX ALL";
            }
        }

        /* Initializes controls and auto-refresh on DOMContentLoaded */
        document.addEventListener('DOMContentLoaded', () => {
            applyDarkMode(); // Apply Dark Mode preference

            const controlsContainer = document.createElement('div');
            controlsContainer.id = 'controls';

            /* Create and append the search input container */
            const searchContainer = document.createElement('div');
            searchContainer.id = 'searchContainer';

            const searchInput = document.createElement('input');
            searchInput.type = 'text';
            searchInput.id = 'searchInput';
            searchInput.placeholder = 'Search table ...';
            searchInput.onkeyup = filterTable;
            searchContainer.appendChild(searchInput);

            /* Create and append the distance filter container */
            const filterContainer = document.createElement('div');
            filterContainer.id = 'filterContainer';

            filterContainer.innerHTML = `
                <label><input type="checkbox" id="filter200" onclick="filterTable()"> >200 km</label>
                <label><input type="checkbox" id="filter450" onclick="filterTable()"> >450 km</label>
                <label><input type="checkbox" id="filter750" onclick="filterTable()"> >750 km</label>
                <label><input type="checkbox" id="filter1200" onclick="filterTable()"> >1200 km</label>
            `;

            searchContainer.appendChild(filterContainer);
            controlsContainer.appendChild(searchContainer);

            /* Create and append the button container */
            const buttonContainer = document.createElement('div');
            buttonContainer.id = 'buttonContainer';

            /* Create and append the dark mode button */
            const darkModeButton = document.createElement('button');
            darkModeButton.id = 'darkModeButton';
            darkModeButton.className = 'button';
            darkModeButton.innerText = 'Toggle Dark Mode';
            darkModeButton.addEventListener('click', toggleDarkMode);
            buttonContainer.appendChild(darkModeButton);

            /* Create and append the refresh button */
            const refreshButton = document.createElement('button');
            refreshButton.id = 'refreshButton';
            refreshButton.className = 'button';
            refreshButton.innerText = 'Auto Refresh: ON';
            refreshButton.addEventListener('click', () => {
                toggleRefresh();
                refreshButton.innerText = `Auto Refresh: ${autoRefresh ? 'ON' : 'OFF'}`;
            });
            buttonContainer.appendChild(refreshButton);

            /* Append the button container to the controls container */
            controlsContainer.appendChild(buttonContainer);

            /* Insert controls above the table */
            document.body.insertBefore(controlsContainer, document.querySelector("pre"));
			
			/* Start auto-refresh if enabled */
            if (autoRefresh) {
                startAutoRefresh();
            }

            /* Add click event listeners to table headers for sorting */
            const headers = document.querySelectorAll("th");
            headers[1].addEventListener("click", () => sortTable(1)); // TIME(UTC)
            headers[2].addEventListener("click", () => sortTable(2, true)); // FREQ
            headers[3].addEventListener("click", () => sortTable(3)); // PI
            headers[4].addEventListener("click", () => sortTable(4)); // PS
            headers[5].addEventListener("click", () => sortTable(5)); // NAME
            headers[6].addEventListener("click", () => sortTable(6)); // CITY
            headers[7].addEventListener("click", () => sortTable(7)); // ITU
            headers[8].addEventListener("click", () => sortTable(8)); // P
            headers[9].addEventListener("click", () => sortTable(9, true)); // ERP
            headers[10].addEventListener("click", () => sortTable(10, true)); // DIST
            headers[11].addEventListener("click", () => sortTable(11, true)); // AZ
            headers[12].addEventListener("click", () => sortTable(12)); // ID

            // Event listeners to ensure only one checkbox is selected
            document.querySelectorAll('#filterContainer input[type="checkbox"]').forEach((checkbox) => {
                checkbox.addEventListener('change', function () {
                    if (this.checked) {
                        document.querySelectorAll('#filterContainer input[type="checkbox"]').forEach((cb) => {
                            if (cb !== this) cb.checked = false;
                        });
                    }
                    filterTable(); // Update the table after changing a checkbox
                });
            });

            generateDynamicLink();
        });
    </script>
</head>
<body>
<pre>